---
title: "PPS - Minimal Reproducible Analysis Example"
author: "Antoine Languillaume"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(readxl)
library(here)

library(car)
library(broom)
library(emmeans)

# Load project functions
source(here("./scripts/MiRAE_funcs.R"))

```


```{r load data}
d <- read_excel(here("./data/processed/fertilizer_trial_WUR.xlsx"),
                sheet = "data")
# Replace unit separator $ => _
# $ is not a syntactic character in R
names(d) <- str_replace_all(names(d), "\\$", "_")
```


# Introduction

Aliquam convallis sollicitudin purus. Praesent aliquam, enim at fermentum mollis, ligula massa adipiscing nisl, ac euismod nibh nisl eu lectus. Fusce vulputate sem at sapien. Vivamus leo. Aliquam euismod libero eu enim. Nulla nec felis sed leo placerat imperdiet. Aenean suscipit nulla in justo. Suspendisse cursus rutrum augue. Nulla tincidunt tincidunt mi. Curabitur iaculis, lorem vel rhoncus faucibus, felis magna fermentum augue, et ultricies lacus lorem varius purus. Curabitur eu amet.

# Material and Methods

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non risus. Suspendisse lectus tortor, dignissim sit amet, adipiscing nec, ultricies sed, dolor. Cras elementum ultrices diam. Maecenas ligula massa, varius a, semper congue, euismod non, mi. Proin porttitor, orci nec nonummy molestie, enim est eleifend mi, non fermentum diam nisl sit amet erat. Duis semper. Duis arcu massa, scelerisque vitae, consequat in, pretium a, enim. Pellentesque congue. Ut in risus volutpat libero pharetra tempor. Cras vestibulum bibendum augue. Praesent egestas leo in pede. Praesent blandit odio eu enim. Pellentesque sed dui ut augue blandit sodales. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Aliquam nibh. Mauris ac mauris sed pede pellentesque fermentum. Maecenas adipiscing ante non diam sodales hendrerit. 

\newpage

# Results

You can directly incorporate your graphs within your memo or manuscript draft.

```{r, fig.align='center'}
ggplot(d)+
  aes(x = fertilizer, y = yield_tha, colour = farm)+
  geom_point(na.rm = TRUE)+
  facet_wrap(farm ~ .)+
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+
  ylim(0, 15)
```



```{r, fig.align='center'}
interaction_plot(x.factor = farm,
                 trace.factor = fertilizer,
                 response = yield_tha,
                 data = d)+
  ylim(0, 15)
```
\newpage

And also tables, all of that dynamically generated within R.

```{r}
fit <- lm(yield_tha ~ farm + fertilizer, data = d)
fit %>%
  pretty_anova_table() %>%
  knitr::kable()
```

```{r, fig.align='center'}
emms <- emmeans(fit,  pairwise ~  farm + fertilizer)

emms_df <- as.data.frame(emms$emmeans)

ggplot(d)+
  aes(x = fertilizer, y = yield_tha, colour = farm)+
  geom_point(na.rm = TRUE,
             position = position_dodge(width = 0.2),
             alpha = 0.2)+
  geom_pointrange(data = emms_df,
                  aes(y = emmean, ymin = lower.CL, ymax = upper.CL),
                  position = position_dodge(width = 0.2))+
  ylim(0, 15)
```

# Dicussion

Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Enim diam vulputate ut pharetra sit amet aliquam id. Libero volutpat sed cras ornare. Accumsan in nisl nisi scelerisque eu. Turpis egestas sed tempus urna et pharetra pharetra. Arcu bibendum at varius vel. Sed faucibus turpis in eu mi. Arcu bibendum at varius vel pharetra vel. Tempor orci eu lobortis elementum nibh tellus molestie nunc. Eu feugiat pretium nibh ipsum consequat. Sagittis eu volutpat odio facilisis mauris. Placerat vestibulum lectus mauris ultrices eros in cursus turpis massa. In vitae turpis massa sed elementum. Aenean et tortor at risus viverra adipiscing. Blandit massa enim nec dui. Proin nibh nisl condimentum id venenatis a. Donec adipiscing tristique risus nec feugiat in fermentum posuere. Neque viverra justo nec ultrices dui. Risus viverra adipiscing at in tellus.

Nunc mi ipsum faucibus vitae aliquet nec. Proin nibh nisl condimentum id venenatis a condimentum vitae. Quis blandit turpis cursus in. Enim facilisis gravida neque convallis a. Praesent elementum facilisis leo vel fringilla est ullamcorper. Mattis pellentesque id nibh tortor. Mattis pellentesque id nibh tortor id aliquet lectus proin. Venenatis lectus magna fringilla urna porttitor rhoncus dolor purus non. Venenatis cras sed felis eget velit aliquet. Commodo sed egestas egestas fringilla phasellus faucibus scelerisque eleifend. Pharetra pharetra massa massa ultricies mi quis hendrerit dolor magna. Ornare arcu odio ut sem nulla pharetra diam sit amet. Eu scelerisque felis imperdiet proin fermentum. Pretium fusce id velit ut tortor pretium viverra. Posuere ac ut consequat semper viverra nam libero.
